@import url('https://fonts.googleapis.com/css2?family=Parisienne&display.swap');
@import url('https://fonts.googleapis.com/css2?family=Archivo+Black&display.swap');

* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  width: 100%;
  overflow-x: hidden;
  overflow: hidden;
  background: linear-gradient(180deg, #1a0d1a 0%, #2b0f2b 100%);
  color: #ffccff;
  -webkit-font-smoothing: antialiased;
  font-family: 'Archivo Black', sans-serif;
}
/* === ĐÃ SỬA LỖI VẠCH TRẮNG Ở ĐÂY === */
.webgl { position: fixed; width: 100%; height: 100%; top: 0; left: 0; outline: none; z-index: 1; }
/* === KẾT THÚC SỬA === */

body::before {
  content: '';
  position: absolute;
  border: 6px solid var(--border-color, #ff99cc);
  inset: 1rem;
  z-index: 100;
  pointer-events: none;
  border-radius: 20px;
  box-shadow: 0 0 20px var(--border-shadow, rgba(255, 153, 204, 0.5)); 
  animation: none;
}
/* === SỬA BODY::BEFORE CHO DI ĐỘNG === */
body.mobile-layout::before {
    inset: 0.5rem; /* Giảm khoảng cách */
    border-width: 4px; /* Viền mỏng hơn */
    border-radius: 10px; /* Bo góc ít hơn */
}

h1 {
  position: absolute;
  top: 8vh;
  left: 2rem;
  right: 2rem;
  text-align: center;
  font-family: 'Parisienne', cursive;
  font-weight: 400;
  font-size: max(3rem, 2vh);
  text-shadow: 0 0 10px rgba(255, 153, 204, 0.7);
  opacity: 0;
  animation: fadeIn 2s ease-in forwards 1s;
  z-index: 100;
}

svg { width: 4vh; fill: #ffccff; }
@keyframes rainbow-border {
  0%   { border-color: #ff0000; box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); }
  16%  { border-color: #ffa500; box-shadow: 0 0 20px rgba(255, 165, 0, 0.5); }
  33%  { border-color: #ffff00; box-shadow: 0 0 20px rgba(255, 255, 0, 0.5); }
  50%  { border-color: #00ff00; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); }
  66%  { border-color: #0000ff; box-shadow: 0 0 20px rgba(0, 0, 255, 0.5); }
  83%  { border-color: #ee82ee; box-shadow: 0 0 20px rgba(238, 130, 238, 0.5); }
  100% { border-color: #ff0000; box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); }
}
@keyframes fadeIn { to { opacity: 1; } }

#startButton {
  position: fixed;
  bottom: 10vh;
  left: 50%;
  transform: translateX(-50%);
  z-index: 200;
  padding: 15px 30px;
  font-size: 1.2rem;
  font-family: 'Archivo Black', sans-serif;
  color: white;
  background: rgba(255, 153, 204, 0.7);
  border: 2px solid white;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  opacity: 0;
  animation: fadeIn 2s ease-in forwards 3s;
}
#startButton:hover {
  background: rgba(255, 153, 204, 1);
  box-shadow: 0 0 15px white, 0 0 25px #ff99cc;
}
#startButton:disabled {
    background: #555;
    cursor: not-allowed;
}

#controls-container {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 300;
  color: white;
}
#toggle-controls, #toggle-fullscreen {
  background: rgba(0, 0, 0, 0.7);
  color: white;
  border: none;
  padding: 10px;
  border-radius: 5px;
  cursor: pointer;
  margin-bottom: 5px;
  backdrop-filter: blur(5px);
  font-family: 'Archivo Black', sans-serif;
  transition: background-color 0.3s ease;
}
#toggle-fullscreen {
  position: fixed;
  top: 20px;
  right: 20px;
  left: auto;
}
#controls {
  background: rgba(100, 100, 100, 0.2);
  padding: 15px;
  border-radius: 10px;
  max-width: 300px;
  backdrop-filter: blur(5px);
  display: block;
  font-family: 'Archivo Black', sans-serif;
}
.control-group {
  margin: 10px 0;
  display: flex;
  align-items: center;
}
.control-group label {
  width: 120px;
  font-size: 14px;
  margin-right: 10px;
}
.control-group input[type="range"] {
  flex-grow: 1;
  margin-right: 10px;
}
.control-group span {
  width: 50px;
  text-align: right;
  font-size: 14px;
}
.control-group select {
  flex-grow: 1;
  padding: 5px;
  border-radius: 4px;
  background: #333;
  color: white;
  border: none;
  font-family: 'Archivo Black', sans-serif;
}

/* KHÔI PHỤC TIM BAY PNG */
img.floating-heart {
    position: absolute;
    pointer-events: none;
    transition: transform 10s linear, opacity 10s ease-out;
    z-index: 50;
}

/* === THÊM MỚI: CLASS CHO ẢNH CỦA BẠN === */
img.custom-floating-image {
    position: absolute;
    pointer-events: none;
    transition: transform 12s linear, opacity 12s ease-out; /* Bay chậm hơn 1 chút */
    z-index: 51; /* Nổi trên tim bay (50) */
    border-radius: 8px; /* Bo góc ảnh cho đẹp */
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3); /* Thêm viền mờ */
}


/* === KHỐI @media (max-width: 600px) ĐÃ BỊ XÓA HOÀN TOÀN === */


/* SỬA LỖI LOGIC MÀU TIM BAY (DÙNG SEPIA) */
@keyframes rainbow-hue {
  0%   { filter: sepia(100%) saturate(1000%) brightness(0.8) hue-rotate(0deg); }
  100% { filter: sepia(100%) saturate(1000%) brightness(0.8) hue-rotate(360deg); }
}
body.floating-color-original img.floating-heart {
  filter: sepia(100%) saturate(1000%) brightness(0.9) hue-rotate(270deg);
}
body.floating-color-red img.floating-heart {
  filter: sepia(100%) saturate(1000%) brightness(0.7) hue-rotate(320deg);
}
body.floating-color-green img.floating-heart {
  filter: sepia(100%) saturate(1000%) brightness(0.7) hue-rotate(40deg);
}
body.floating-color-blue img.floating-heart {
  filter: sepia(100%) saturate(1000%) brightness(0.7) hue-rotate(180deg);
}
body.floating-color-monochrome img.floating-heart {
  filter: saturate(0) brightness(1.5);
}
body.floating-color-rainbow img.floating-heart {
  animation: rainbow-hue 3s linear infinite;
}
.love-text-content {
  /* Cài đặt ban đầu */
  opacity: 1; /* Luôn hiển thị */
  width: 100%; /* Luôn chiếm đủ chiều rộng */
  white-space: normal; /* Cho phép xuống dòng (như bạn muốn) */
  overflow: hidden;
  border-bottom: 2px solid transparent; /* Dấu nháy (ban đầu trong suốt) */
  
  /* CÁC THUỘC TÍNH BỊ XÓA: opacity: 0, width: 0 */
}

/* Keyframe cho dấu nháy (GIỮ NGUYÊN) */
@keyframes blink-caret {
  from, to { border-color: transparent; }
  50% { border-color: rgba(255, 204, 255, 0.75); }
}

/* Class kích hoạt (JS sẽ thêm/xóa) */
.love-text-container {
  position: fixed; /* Giữ cố định trên màn hình */
  top: 50%; /* Căn giữa theo chiều dọc */
  transform: translateY(var(--heart-y-offset, -50%)); /* Áp dụng Y-offset từ JS */
  z-index: 100; /* Đặt TRÊN canvas (z-index: 1) và ảnh bay (51) */

  width: 300px; /* Đặt chiều rộng cố định cho hộp */
  font-family: 'Parisienne', cursive;
  font-size: 1.5rem;
  line-height: 1.4;
  color: #ffccff;
  text-shadow: 0 0 8px rgba(255, 153, 204, 0.7);
  padding: 15px;
  
  /* Thêm nền mờ để dễ đọc hơn */
  background: rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(5px);
  border-radius: 10px;
  border: 1px solid rgba(255, 204, 255, 0.2);

  /* Dùng cho JS điều khiển ẩn/hiện */
  opacity: 0; 
  transition: opacity 1s ease-out;
  }

  /* Định vị hộp bên trái */
  #love-text-left {
    left: var(--heart-width-offset, 5vw); /* Áp dụng X-offset từ JS */
  }

  /* Định vị hộp bên phải */
  #love-text-right {
    right: var(--heart-width-offset, 5vw); /* Áp dụng X-offset từ JS */
  }

  /* === KẾT THÚC ĐOẠN THÊM === */
  .love-text-content.start-typing {
    opacity: 1;
    /* CHỈ CÒN LẠI ANIMATION DẤU NHÁY */
    animation: blink-caret .75s step-end infinite;
    
    /* XÓA BỎ: animation 'typing' và 'steps()' */
  }

  /* Class để ẩn đi (JS sẽ thêm) */
  .love-text-content.hide-text {
    opacity: 0;
    transition: opacity 1s ease-out;
    /* XÓA BỎ: width 0, animation none, v.v... */
  }
  body.border-rainbow::before {
  animation: rainbow-border 4s linear infinite;
  }

/* === CSS MỚI CHO DI ĐỘNG XOAY NGANG (LANDSCAPE) === */
/* (Đây là code thay thế cho khối @media cũ) */

/* Áp dụng chung cho di động (giống @media (max-width: 600px) cũ) */
body.mobile-layout h1 {
  font-size: max(2.5rem, 1.5vh);
  top: 6vh;
}
body.mobile-layout #startButton {
  bottom: 12vh;
  padding: 12px 25px;
  font-size: 1rem;
}
body.mobile-layout #controls-container {
  top: 10px;
  left: 10px;
  right: 10px;
  max-width: none;
}
body.mobile-layout #toggle-controls, 
body.mobile-layout #toggle-fullscreen {
  padding: 8px 10px;
  font-size: 12px;
}
body.mobile-layout #toggle-fullscreen { top: 10px; right: 10px; }
body.mobile-layout #controls { padding: 10px; }
body.mobile-layout .control-group { margin: 8px 0; }
body.mobile-layout .control-group label { width: 80px; font-size: 12px; }
body.mobile-layout .control-group span { width: 40px; font-size: 12px; }
body.mobile-layout .control-group select { font-size: 12px; padding: 4px; }
body.mobile-layout .control-group input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 5px;
    background: #555;
    border-radius: 5px;
    outline: none;
}
body.mobile-layout .love-text-container {
  width: 42vw;
  min-width: 140px;
  font-size: 1.2rem;
  padding: 10px;
}
body.mobile-layout #love-text-left { left: 3vw; }
body.mobile-layout #love-text-right { right: 3vw; }

/* === CHỈ ÁP DỤNG KHI XOAY NGANG === */
body.landscape-layout #controls-container {
  /* Thu hẹp bảng lệnh và đẩy sang trái */
  max-width: 240px; 
  right: auto;
}
body.landscape-layout #controls {
  /* Giảm đệm cho vừa */
  padding: 5px;
}
body.landscape-layout .control-group {
  margin: 5px 0; /* Giảm khoảng cách */
}
body.landscape-layout .control-group label { 
  width: 70px; /* Chữ nhỏ hơn */
  font-size: 10px; 
  margin-right: 5px;
}
body.landscape-layout .control-group span { 
  width: 35px; 
  font-size: 10px;
}
body.landscape-layout .control-group select { 
  font-size: 10px; 
  padding: 3px;
}
/* Đẩy chữ ra sau bảng lệnh */
body.landscape-layout #love-text-left { 
  left: 250px; /* 240px (bảng) + 10px (đệm) */
  top: 45%;
} 
body.landscape-layout #love-text-right {
  right: 3vw;
  top: 45%;
}
body.landscape-layout .love-text-container {
  /* Thu nhỏ chữ 1 chút */
  font-size: 1.1rem;
  width: 30vw;
}